{"version":3,"file":"index.js","names":["_textlintRuleHelper","require","containsSpaces","str","test","isFullWidth","char","code","charCodeAt","isSymbol","symbols","isHalfWidth","extractHalfWidthSequences","text","startIndex","sequences","currentSeq","seqStart","startsAfterSymbol","i","length","trimmedText","trim","push","start","end","reporter","context","Syntax","RuleError","report","getSource","locator","helper","RuleHelper","Link","node","parent","parentText","linkStart","range","linkEnd","beforeIndex","beforeChar","padding","at","afterIndex","afterChar","Str","isChildNode","Image","BlockQuote","Code","Header","forEach","seq","hasSpaces","seqStartInText","seqEndInText","hasSpaceBefore","substring","hasSpaceAfter"],"sources":["../src/index.js"],"sourcesContent":["/**\n * @fileoverview Rule to check spacing between full-width and half-width strings\n * - No space between full-width and half-width strings without spaces\n * - Space required between full-width and half-width strings with spaces\n */\n\nimport { RuleHelper } from 'textlint-rule-helper';\n\n/**\n * Check if a string contains spaces\n * @param {string} str - String to check\n * @returns {boolean} True if string contains spaces\n */\nfunction containsSpaces(str) {\n  return /\\s/.test(str);\n}\n\n/**\n * Check if a character is full-width\n * @param {string} char - Character to check\n * @returns {boolean} True if character is full-width\n */\nfunction isFullWidth(char) {\n  const code = char.charCodeAt(0);\n  // Full-width characters (Hiragana, Katakana, Kanji, full-width symbols)\n  return (\n    (code >= 0x3000 && code <= 0x303f) || // CJK Symbols and Punctuation\n    (code >= 0x3040 && code <= 0x309f) || // Hiragana\n    (code >= 0x30a0 && code <= 0x30ff) || // Katakana\n    (code >= 0x4e00 && code <= 0x9fff) || // CJK Unified Ideographs\n    (code >= 0xff00 && code <= 0xffef)    // Full-width forms\n  );\n}\n\n/**\n * Check if a character is a symbol/punctuation\n * @param {string} char - Character to check\n * @returns {boolean} True if character is a symbol\n */\nfunction isSymbol(char) {\n  // Common symbols and punctuation marks (half-width and full-width)\n  const symbols = /[.,;:!?()[\\]{}<>'\"`\"\\-=+*\\/\\\\|~@#$%^&_（）「」『』【】〈〉《》〔〕［］｛｝、。！？：；・…‥〜～ー※]/;\n  return symbols.test(char);\n}\n\n/**\n * Check if a character is half-width (excluding spaces and symbols)\n * @param {string} char - Character to check\n * @returns {boolean} True if character is half-width\n */\nfunction isHalfWidth(char) {\n  return !isFullWidth(char) && char !== ' ' && char !== '\\t' && char !== '\\n' && !isSymbol(char);\n}\n\n/**\n * Extract half-width sequences from text\n * @param {string} text - Text to analyze\n * @param {number} startIndex - Start index in the original text\n * @returns {Array} Array of half-width sequences with their positions and metadata\n */\nfunction extractHalfWidthSequences(text, startIndex) {\n  const sequences = [];\n  let currentSeq = '';\n  let seqStart = -1;\n  let startsAfterSymbol = false;\n\n  for (let i = 0; i < text.length; i++) {\n    const char = text[i];\n    if (isHalfWidth(char) || char === ' ' || char === '\\t') {\n      if (currentSeq === '') {\n        seqStart = i;\n        // Check if this sequence starts after a symbol (including symbol + space)\n        startsAfterSymbol = (i > 0 && isSymbol(text[i - 1]));\n      }\n      currentSeq += char;\n      \n      // Check if next character is a symbol - if so, end the sequence here\n      if (i + 1 < text.length && isSymbol(text[i + 1])) {\n        if (currentSeq !== '') {\n          const trimmedText = currentSeq.trim();\n          sequences.push({\n            text: trimmedText,\n            start: startIndex + seqStart,\n            end: startIndex + i + 1,\n            startsAfterSymbol: startsAfterSymbol\n          });\n          currentSeq = '';\n        }\n      }\n    } else {\n      if (currentSeq !== '') {\n        const trimmedText = currentSeq.trim();\n        sequences.push({\n          text: trimmedText,\n          start: startIndex + seqStart,\n          end: startIndex + i,\n          startsAfterSymbol: startsAfterSymbol\n        });\n        currentSeq = '';\n      }\n      // Reset startsAfterSymbol when we hit a non-half-width, non-space character\n      startsAfterSymbol = isSymbol(char);\n    }\n  }\n\n  if (currentSeq !== '') {\n    const trimmedText = currentSeq.trim();\n    sequences.push({\n      text: trimmedText,\n      start: startIndex + seqStart,\n      end: startIndex + text.length,\n      startsAfterSymbol: startsAfterSymbol\n    });\n  }\n\n  return sequences;\n}\n\n/**\n * @param {import(\"@textlint/types\").TextlintRuleContext} context\n * @returns {import(\"@textlint/types\").TextlintRuleCreator}\n */\nexport default function reporter(context) {\n  const { Syntax, RuleError, report, getSource, locator } = context;\n  const helper = new RuleHelper(context);\n\n  return {\n    [Syntax.Link](node) {\n      // Check spacing around links (URLs)\n      // Links should always have spaces around them when adjacent to full-width characters\n      const parent = node.parent;\n      if (!parent) {\n        return;\n      }\n\n      const parentText = getSource(parent);\n      const linkStart = node.range[0] - parent.range[0];\n      const linkEnd = node.range[1] - parent.range[0];\n\n      // Check before the link\n      const beforeIndex = linkStart - 1;\n      if (beforeIndex >= 0) {\n        const beforeChar = parentText[beforeIndex];\n        if (isFullWidth(beforeChar) && parentText[linkStart] !== ' ') {\n          report(parent, new RuleError(\n            `全角文字とURLの間にはスペースを入れる必要があります`,\n            { padding: locator.at(linkStart) }\n          ));\n        }\n      }\n\n      // Check after the link\n      const afterIndex = linkEnd;\n      if (afterIndex < parentText.length) {\n        const afterChar = parentText[afterIndex];\n        if (isFullWidth(afterChar) && parentText[linkEnd - 1] !== ' ') {\n          report(parent, new RuleError(\n            `URLと全角文字の間にはスペースを入れる必要があります`,\n            { padding: locator.at(afterIndex) }\n          ));\n        }\n      }\n    },\n\n    [Syntax.Str](node) {\n      // Skip if node should be ignored\n      if (helper.isChildNode(node, [Syntax.Link, Syntax.Image, Syntax.BlockQuote, Syntax.Code, Syntax.Header])) {\n        return;\n      }\n\n      const text = getSource(node);\n      const sequences = extractHalfWidthSequences(text, node.range[0]);\n\n      sequences.forEach(seq => {\n        // Skip empty sequences\n        if (!seq.text) {\n          return;\n        }\n\n        // Skip sequences that start after symbols (like \": CommonJS\" after \"Node.js:\")\n        if (seq.startsAfterSymbol) {\n          return;\n        }\n\n        const hasSpaces = containsSpaces(seq.text);\n        const seqStartInText = seq.start - node.range[0];\n        const seqEndInText = seq.end - node.range[0];\n        \n        // Check before the sequence\n        const beforeIndex = seqStartInText - 1;\n        if (beforeIndex >= 0) {\n          const beforeChar = text[beforeIndex];\n          \n          // Skip if before character is a symbol\n          if (isSymbol(beforeChar)) {\n            return;\n          }\n          \n          if (isFullWidth(beforeChar)) {\n            // Check if there's a space between full-width char and half-width sequence\n            const hasSpaceBefore = (beforeIndex + 1 < text.length && text[beforeIndex + 1] === ' ');\n            \n            if (hasSpaces && !hasSpaceBefore) {\n              // Should have space but doesn't\n              report(node, new RuleError(\n                `全角文字とスペースを含む半角文字列の間にはスペースを入れる必要があります: \"${beforeChar}${seq.text.substring(0, 10)}...\"`,\n                { padding: locator.at(beforeIndex + 1) }\n              ));\n            } else if (!hasSpaces && hasSpaceBefore) {\n              // Should not have space but does\n              report(node, new RuleError(\n                `全角文字とスペースを含まない半角文字列の間にはスペースを入れないでください: \"${beforeChar} ${seq.text}\"`,\n                { padding: locator.at(beforeIndex + 1) }\n              ));\n            }\n          }\n        }\n\n        // Check after the sequence\n        const afterIndex = seqEndInText;\n        if (afterIndex < text.length) {\n          const afterChar = text[afterIndex];\n          \n          // Skip if after character is a symbol\n          if (isSymbol(afterChar)) {\n            return;\n          }\n          \n          if (isFullWidth(afterChar)) {\n            // Check if there's a space between half-width sequence and full-width char\n            const hasSpaceAfter = (afterIndex > 0 && text[afterIndex - 1] === ' ');\n            \n            if (hasSpaces && !hasSpaceAfter) {\n              // Should have space but doesn't\n              report(node, new RuleError(\n                `全角文字とスペースを含む半角文字列の間にはスペースを入れる必要があります: \"...${seq.text.substring(seq.text.length - 10)}${afterChar}\"`,\n                { padding: locator.at(afterIndex) }\n              ));\n            } else if (!hasSpaces && hasSpaceAfter) {\n              // Should not have space but does\n              report(node, new RuleError(\n                `全角文字とスペースを含まない半角文字列の間にはスペースを入れないでください: \"${seq.text} ${afterChar}\"`,\n                { padding: locator.at(afterIndex - 1) }\n              ));\n            }\n          }\n        }\n      });\n    }\n  };\n}\n"],"mappings":"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","ignoreList":[]}